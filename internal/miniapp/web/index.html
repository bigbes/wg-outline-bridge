<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WG-Outline Bridge Admin</title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div
            id="unauthorized"
            style="display: none; text-align: center; padding: 40px 20px"
        >
            <div style="font-size: 80px; line-height: 1; margin-bottom: 16px">
                ğŸ•¸ï¸ğŸ•·ï¸ğŸ•¸ï¸
            </div>
            <h1 style="font-size: 22px; margin-bottom: 12px">
                Nothing to see here
            </h1>
            <p
                style="
                    color: var(--hint);
                    font-size: 14px;
                    max-width: 300px;
                    margin: 0 auto 16px;
                "
            >
                This admin panel only works inside Telegram.<br />
                A wild spider has taken over this page in the meantime.
            </p>
            <p style="font-size: 12px; color: var(--hint)">
                ğŸšª Please open this via the Telegram bot menu.
            </p>
        </div>

        <div
            id="forbidden"
            style="display: none; text-align: center; padding: 40px 20px"
        >
            <div style="font-size: 80px; line-height: 1; margin-bottom: 16px">
                ğŸ”ğŸ”ğŸ”
            </div>
            <h1 style="font-size: 22px; margin-bottom: 12px">
                Bawk! Access denied!
            </h1>
            <p
                style="
                    color: var(--hint);
                    font-size: 14px;
                    max-width: 300px;
                    margin: 0 auto 16px;
                "
            >
                Only the farmer gets in here.<br />
                You're just a chicken passing by. ğŸ£
            </p>
            <p style="font-size: 12px; color: var(--hint)">
                ğŸšœ Ask the admin to add you to the coop.
            </p>
        </div>

        <div id="app">
            <h1>ğŸŒ WG-Outline Bridge</h1>
            <div id="status-bar" class="status-bar">
                <span id="alive-dot" class="alive-dot"></span>
                <span id="uptime" class="uptime-text"></span>
                <span id="current-user" class="uptime-text"></span>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('peers')">
                    ğŸ‘¥<span class="tab-label"> Peers</span>
                </button>
                <button class="tab" onclick="showTab('upstreams')">
                    ğŸ”—<span class="tab-label"> Upstreams</span>
                </button>
                <button class="tab" onclick="showTab('proxies')">
                    ğŸ”Œ<span class="tab-label"> Proxies</span>
                </button>
                <button class="tab" onclick="showTab('dns')">
                    ğŸ”<span class="tab-label"> DNS</span>
                </button>
                <button class="tab" onclick="showTab('users')">
                    ğŸ”<span class="tab-label"> Users</span>
                </button>
            </div>

            <div id="loading" class="loading">Loading...</div>

            <div id="peers" class="section active">
                <div id="peers-list"></div>
                <div class="input-row">
                    <input
                        class="input"
                        id="new-peer-name"
                        placeholder="New peer name"
                    />
                    <button class="btn btn-sm" onclick="addPeer()">
                        + Add
                    </button>
                </div>
                <div id="peer-msg"></div>
            </div>

            <div id="upstreams" class="section">
                <div class="sub-tabs">
                    <button
                        class="tab active"
                        onclick="
                            showSubTab(
                                'upstream-list-view',
                                'upstream-groups-view',
                                this,
                            )
                        "
                    >
                        ğŸ”— List
                    </button>
                    <button
                        class="tab"
                        onclick="
                            showSubTab(
                                'upstream-groups-view',
                                'upstream-list-view',
                                this,
                            )
                        "
                    >
                        ğŸ“¦ Groups
                    </button>
                </div>
                <div id="upstream-list-view">
                    <div id="upstreams-list"></div>
                    <h2 class="admin-only">Add Upstream</h2>
                    <div
                        class="admin-only"
                        style="display: flex; flex-direction: column; gap: 6px"
                    >
                        <div class="input-row">
                            <input
                                class="input"
                                id="new-upstream-name"
                                placeholder="Name"
                            />
                            <select
                                class="input"
                                id="new-upstream-type"
                                style="flex: 0.5"
                            >
                                <option value="outline">Outline</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <input
                                class="input"
                                id="new-upstream-transport"
                                placeholder="Transport URI (ss://...)"
                            />
                        </div>
                        <div class="input-row">
                            <label
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 4px;
                                    font-size: 13px;
                                    color: var(--hint);
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="new-upstream-default"
                                />
                                Default
                            </label>
                            <label
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 4px;
                                    font-size: 13px;
                                    color: var(--hint);
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="new-upstream-hc"
                                    checked
                                />
                                Health check
                            </label>
                            <button class="btn btn-sm" onclick="addUpstream()">
                                + Add
                            </button>
                        </div>
                    </div>
                    <div id="upstream-msg"></div>
                </div>
                <div id="upstream-groups-view" style="display: none">
                    <div id="groups-list"></div>
                    <h2 class="admin-only">Assign Upstream to Group</h2>
                    <div class="input-row admin-only">
                        <select
                            class="input"
                            id="group-upstream-select"
                            style="flex: 1"
                        >
                            <option value="">Select upstreamâ€¦</option>
                        </select>
                        <input
                            class="input"
                            id="group-name-input"
                            placeholder="Group name"
                            style="flex: 1"
                        />
                        <button class="btn btn-sm" onclick="addToGroup()">
                            + Add
                        </button>
                    </div>
                    <div id="group-msg"></div>
                </div>
            </div>

            <div id="proxies" class="section">
                <div class="sub-tabs">
                    <button
                        class="tab active"
                        onclick="showProxySubTab('mtproxy')"
                    >
                        ğŸ“¡ MTProxy
                    </button>
                    <button class="tab" onclick="showProxySubTab('socks5')">
                        ğŸ§¦ SOCKS5
                    </button>
                    <button class="tab" onclick="showProxySubTab('http')">
                        ğŸŒ HTTP
                    </button>
                    <button class="tab" onclick="showProxySubTab('https')">
                        ğŸ”’ HTTPS
                    </button>
                </div>
                <div id="proxy-sub-mtproxy">
                    <div id="mtproxy-status"></div>
                    <div id="proxy-links"></div>
                    <div class="input-row">
                        <select
                            class="input"
                            id="new-secret-type"
                            style="flex: 0.6"
                        >
                            <option value="faketls">FakeTLS (ee)</option>
                            <option value="padded">Padded (dd)</option>
                            <option value="default">Default</option>
                        </select>
                        <button class="btn btn-sm" onclick="addSecret()">
                            + Add Secret
                        </button>
                    </div>
                    <div id="secret-msg"></div>
                </div>
                <div id="proxy-sub-socks5" style="display: none">
                    <div id="proxies-list-socks5"></div>
                    <h2>Add SOCKS5 Proxy</h2>
                    <div
                        style="display: flex; flex-direction: column; gap: 6px"
                    >
                        <div class="input-row">
                            <input
                                class="input"
                                id="new-proxy-listen-socks5"
                                placeholder="0.0.0.0:1080"
                            />
                            <input
                                class="input"
                                id="new-proxy-name-socks5"
                                placeholder="Name (optional)"
                            />
                            <button
                                class="btn btn-sm"
                                onclick="addProxyTyped('socks5')"
                            >
                                + Add
                            </button>
                        </div>
                    </div>
                    <div id="proxy-msg-socks5"></div>
                </div>
                <div id="proxy-sub-http" style="display: none">
                    <div id="proxies-list-http"></div>
                    <h2>Add HTTP Proxy</h2>
                    <div
                        style="display: flex; flex-direction: column; gap: 6px"
                    >
                        <div class="input-row">
                            <input
                                class="input"
                                id="new-proxy-listen-http"
                                placeholder="0.0.0.0:8080"
                            />
                            <input
                                class="input"
                                id="new-proxy-name-http"
                                placeholder="Name (optional)"
                            />
                            <button
                                class="btn btn-sm"
                                onclick="addProxyTyped('http')"
                            >
                                + Add
                            </button>
                        </div>
                    </div>
                    <div id="proxy-msg-http"></div>
                </div>
                <div id="proxy-sub-https" style="display: none">
                    <div id="proxies-list-https"></div>
                    <h2>Add HTTPS Proxy</h2>
                    <div
                        style="display: flex; flex-direction: column; gap: 6px"
                    >
                        <div class="input-row">
                            <input
                                class="input"
                                id="new-proxy-listen-https"
                                placeholder="0.0.0.0:8443"
                            />
                            <input
                                class="input"
                                id="new-proxy-name-https"
                                placeholder="Name (optional)"
                            />
                            <button
                                class="btn btn-sm"
                                onclick="addProxyTyped('https')"
                            >
                                + Add
                            </button>
                        </div>
                    </div>
                    <div id="proxy-msg-https"></div>
                </div>
            </div>

            <div id="dns" class="section">
                <div id="dns-status"></div>
                <div id="dns-records"></div>
                <div id="dns-rules"></div>
                <h2 class="admin-only">â• Add Rule</h2>
                <div class="admin-only" style="display: flex; flex-direction: column; gap: 6px">
                    <div class="input-row">
                        <input
                            class="input"
                            id="new-dns-rule-name"
                            placeholder="Rule name"
                        />
                        <select
                            class="input"
                            id="new-dns-rule-action"
                            style="flex: 0.6"
                            onchange="dnsActionChanged()"
                        >
                            <option value="block">ğŸš« Block</option>
                            <option value="upstream">â†—ï¸ Upstream</option>
                        </select>
                    </div>
                    <div
                        class="input-row"
                        id="dns-upstream-row"
                        style="display: none"
                    >
                        <input
                            class="input"
                            id="new-dns-rule-upstream"
                            placeholder="Upstream (e.g. 8.8.8.8:53)"
                        />
                    </div>
                    <div class="input-row">
                        <input
                            class="input"
                            id="new-dns-rule-domains"
                            placeholder="Domains (comma-separated, e.g. *.ads.com, tracker.net)"
                        />
                    </div>
                    <div class="input-row">
                        <input
                            class="input"
                            id="new-dns-rule-list-url"
                            placeholder="Blocklist URL (optional)"
                        />
                        <select
                            class="input"
                            id="new-dns-rule-list-format"
                            style="flex: 0.5"
                        >
                            <option value="domains">domains</option>
                            <option value="hosts">hosts</option>
                        </select>
                    </div>
                    <button class="btn btn-sm" onclick="addDNSRule()">
                        + Add Rule
                    </button>
                </div>
                <div id="dns-msg"></div>
            </div>

            <div id="users" class="section">
                <div id="users-list"></div>
                <h2>Grant Access</h2>
                <div class="input-row">
                    <input
                        class="input"
                        id="new-user"
                        placeholder="@username or user ID"
                    />
                    <button class="btn btn-sm" onclick="addUser()">
                        + Add
                    </button>
                </div>
                <div id="user-msg"></div>
            </div>
        </div>

        <script src="app.js"></script>
    </body>
</html>
