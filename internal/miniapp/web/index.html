<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <title>WG-Outline Bridge</title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@fontsource/inter@5.0.18/index.min.css"
        />
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div id="unauthorized">
            <div style="font-size: 80px; line-height: 1; margin-bottom: 16px">
                üï∏Ô∏èüï∑Ô∏èüï∏Ô∏è
            </div>
            <h1 style="font-size: 22px; margin-bottom: 12px">
                Nothing to see here
            </h1>
            <p
                style="
                    color: var(--text-secondary);
                    font-size: 14px;
                    max-width: 300px;
                    margin: 0 auto 16px;
                "
            >
                This admin panel only works inside Telegram.<br />A wild spider
                has taken over this page in the meantime.
            </p>
            <p style="font-size: 12px; color: var(--text-secondary)">
                üö™ Please open this via the Telegram bot menu.
            </p>
        </div>

        <div id="forbidden">
            <div style="font-size: 80px; line-height: 1; margin-bottom: 16px">
                üêîüêîüêî
            </div>
            <h1 style="font-size: 22px; margin-bottom: 12px">
                Bawk! Access denied!
            </h1>
            <p
                style="
                    color: var(--text-secondary);
                    font-size: 14px;
                    max-width: 300px;
                    margin: 0 auto 16px;
                "
            >
                Only the farmer gets in here.<br />You're just a chicken passing
                by. üê£
            </p>
            <p style="font-size: 12px; color: var(--text-secondary)">
                üöú Ask the admin to add you to the coop.
            </p>
        </div>

        <div id="loading">Loading...</div>

        <div id="app">
            <button class="theme-switcher" id="theme-switcher" onclick="cycleTheme()"></button>
            <div class="status-bar admin-only">
                <div class="status-bar-left">
                    <span class="alive-dot" id="alive-dot"></span>
                    <span id="uptime"></span>
                </div>
                <button
                    class="status-bar-admin-btn admin-only"
                    onclick="switchTab('admin')"
                >
                    Admin
                </button>
            </div>

            <!-- Page: Peers (default) -->
            <div class="page active" id="page-peers">
                <header class="header">
                    <div class="bot-icon wg">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <circle
                                cx="12"
                                cy="12"
                                r="3"
                                stroke="white"
                                stroke-width="2"
                            />
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"
                                fill="white"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">WireGuard Peers</h1>
                    <p class="bot-subtitle">Manage client configurations</p>
                </header>
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="wg-stat-total">0</div>
                        <div class="stat-label">Total Peers</div>
                    </div>
                    <div class="stat-card">
                        <div
                            class="stat-value"
                            id="wg-stat-active"
                            style="color: var(--active-green)"
                        >
                            0
                        </div>
                        <div class="stat-label">Connected</div>
                    </div>
                </section>
                <div class="action-btn" onclick="openPeerModal()">
                    <div class="action-icon-circle wg">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text wg">Create Peer</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="section-title-row">
                    <h2 class="section-title">Client Peers</h2>
                    <span
                        class="filter-checkbox admin-only"
                        id="peers-only-mine-cb"
                        onclick="togglePeersOnlyMine()"
                    ></span>
                </div>
                <div class="list-group" id="peer-list"></div>
            </div>

            <!-- Page: Upstreams -->
            <div class="page" id="page-upstreams">
                <header class="header">
                    <div class="bot-icon upstream">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <circle
                                cx="12"
                                cy="12"
                                r="10"
                                stroke="white"
                                stroke-width="2"
                            />
                            <path
                                d="M12 6v6l4 2"
                                stroke="white"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">Upstreams</h1>
                    <p class="bot-subtitle">Configure backend connections</p>
                </header>
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="upstream-stat-total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div
                            class="stat-value"
                            id="upstream-stat-active"
                            style="color: var(--active-green)"
                        >
                            0
                        </div>
                        <div class="stat-label">Healthy</div>
                    </div>
                </section>
                <div
                    class="action-btn admin-only"
                    onclick="openUpstreamModal()"
                >
                    <div class="action-icon-circle upstream">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text upstream">Add Upstream</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openGroupModal()">
                    <div class="action-icon-circle group">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text group">Add Group</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <h2 class="section-title">Upstream Groups</h2>
                <div class="list-group" id="upstream-group-list"></div>
                <h2 class="section-title">Upstreams</h2>
                <div class="list-group" id="upstream-list"></div>
            </div>

            <!-- Page: Proxies -->
            <div class="page" id="page-proxies">
                <header class="header">
                    <div class="bot-icon">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <rect
                                x="2"
                                y="3"
                                width="20"
                                height="14"
                                rx="2"
                                ry="2"
                                stroke="white"
                                stroke-width="2"
                            />
                            <line
                                x1="8"
                                y1="21"
                                x2="16"
                                y2="21"
                                stroke="white"
                                stroke-width="2"
                            />
                            <line
                                x1="12"
                                y1="17"
                                x2="12"
                                y2="21"
                                stroke="white"
                                stroke-width="2"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">Proxy Servers</h1>
                    <p class="bot-subtitle">SOCKS5 / HTTP / HTTPS proxies</p>
                </header>
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="proxy-stat-total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div
                            class="stat-value"
                            id="proxy-stat-types"
                            style="color: var(--accent-blue)"
                        >
                            ‚Äî
                        </div>
                        <div class="stat-label">Types</div>
                    </div>
                </section>
                <div class="action-btn admin-only" onclick="openProxyModal()">
                    <div class="action-icon-circle">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text">Add Proxy Server</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <h2 class="section-title">Proxy Servers</h2>
                <div class="list-group" id="proxy-list"></div>
            </div>

            <!-- Page: DNS -->
            <div class="page" id="page-dns">
                <header class="header">
                    <div class="bot-icon dns">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <circle
                                cx="12"
                                cy="12"
                                r="10"
                                stroke="white"
                                stroke-width="2"
                            />
                            <path
                                d="M12 6v6l4 2"
                                stroke="white"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                            <circle cx="12" cy="12" r="3" fill="white" />
                        </svg>
                    </div>
                    <h1 class="bot-title">DNS Settings</h1>
                    <p class="bot-subtitle">Configure DNS resolution</p>
                </header>
                <div class="list-group" style="margin: 0 16px 24px">
                    <div class="list-item">
                        <div class="item-icon dns-record">
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="10" />
                                <path d="M12 6v6l4 2" />
                            </svg>
                        </div>
                        <div class="item-content">
                            <div class="item-title">DNS Resolution</div>
                            <div class="item-subtitle" id="dns-status-text">
                                Disabled
                            </div>
                        </div>
                        <div class="item-action">
                            <span class="status-badge" id="dns-status-badge"
                                >OFF</span
                            >
                        </div>
                    </div>
                </div>
                <div
                    class="action-btn admin-only"
                    onclick="openDNSRecordModal()"
                >
                    <div class="action-icon-circle dns">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text dns">Add DNS Record</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openDNSRuleModal()">
                    <div class="action-icon-circle dns">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text dns">Add DNS Rule</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <h2 class="section-title">DNS Records</h2>
                <div class="list-group" id="dns-record-list"></div>
                <h2 class="section-title">DNS Rules</h2>
                <div class="list-group" id="dns-rule-list"></div>
            </div>

            <!-- Page: Routing -->
            <div class="page" id="page-routing">
                <header class="header">
                    <div class="bot-icon routing">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M22 12h-4l-3 9L9 3l-3 9H2"
                                stroke="white"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">Routing</h1>
                    <p class="bot-subtitle">IP & SNI routing rules</p>
                </header>
                <div class="list-group" style="margin: 0 16px 24px">
                    <div class="list-item admin-only" onclick="toggleRoutingEnabled()" style="cursor:pointer">
                        <div class="item-icon routing-cidr">
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <div class="item-content">
                            <div class="item-title">Routing Rules</div>
                            <div class="item-subtitle" id="routing-status-text">
                                Disabled
                            </div>
                        </div>
                        <div class="item-action">
                            <span class="status-badge" id="routing-status-badge"
                                >OFF</span
                            >
                        </div>
                    </div>
                </div>
                <div
                    class="action-btn admin-only"
                    onclick="openRoutingCIDRModal()"
                >
                    <div class="action-icon-circle routing">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text routing">Add CIDR</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openIPRuleModal()">
                    <div class="action-icon-circle routing">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text routing">Add IP Rule</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openSNIRuleModal()">
                    <div class="action-icon-circle routing">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text routing">Add SNI Rule</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openPortRuleModal()">
                    <div class="action-icon-circle routing">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text routing">Add Port Rule</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openProtocolRuleModal()">
                    <div class="action-icon-circle routing">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text routing">Add Protocol Rule</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <h2 class="section-title">CIDRs</h2>
                <div class="list-group" id="routing-cidr-list"></div>
                <h2 class="section-title">IP Rules</h2>
                <div class="list-group" id="routing-ip-rule-list"></div>
                <h2 class="section-title">SNI Rules</h2>
                <div class="list-group" id="routing-sni-rule-list"></div>
                <h2 class="section-title">Port Rules</h2>
                <div class="list-group" id="routing-port-rule-list"></div>
                <h2 class="section-title">Protocol Rules</h2>
                <div class="list-group" id="routing-protocol-rule-list"></div>
            </div>

            <!-- Page: Users -->
            <div class="page" id="page-users">
                <header class="header">
                    <div class="bot-icon users">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                                stroke="white"
                                stroke-width="2"
                            />
                            <circle
                                cx="12"
                                cy="7"
                                r="4"
                                stroke="white"
                                stroke-width="2"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">Users</h1>
                    <p class="bot-subtitle">Manage access control</p>
                </header>
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="user-stat-total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div
                            class="stat-value"
                            id="user-stat-admin"
                            style="color: var(--admin-gold)"
                        >
                            0
                        </div>
                        <div class="stat-label">Admins</div>
                    </div>
                </section>
                <div class="action-btn admin-only" onclick="openUserModal()">
                    <div class="action-icon-circle users">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text users">Add User</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn admin-only" onclick="openInviteModal()">
                    <div class="action-icon-circle users">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <path
                                d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                            />
                            <path
                                d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                            />
                        </svg>
                    </div>
                    <div class="action-text users">Create Invite Link</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <h2 class="section-title">Invite Links</h2>
                <div class="list-group" id="invite-list"></div>
                <h2 class="section-title">All Users</h2>
                <div class="list-group" id="user-list"></div>
            </div>

            <!-- Page: MTProxy -->
            <div class="page" id="page-mtproxy">
                <header class="header">
                    <div class="bot-icon mtproxy">
                        <svg
                            width="40"
                            height="40"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                                stroke="white"
                                stroke-width="2"
                            />
                        </svg>
                    </div>
                    <h1 class="bot-title">MTProxy</h1>
                    <p class="bot-subtitle">Telegram MTProto Proxy</p>
                </header>
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="mtproxy-stat-secrets">
                            0
                        </div>
                        <div class="stat-label">Secrets</div>
                    </div>
                    <div class="stat-card">
                        <div
                            class="stat-value"
                            id="mtproxy-stat-active"
                            style="color: var(--active-green)"
                        >
                            0
                        </div>
                        <div class="stat-label">Connections</div>
                    </div>
                </section>
                <div class="action-btn" onclick="openSecretModal()">
                    <div class="action-icon-circle mtproxy">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                        >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                    </div>
                    <div class="action-text mtproxy">Add Secret</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="section-title-row">
                    <h2 class="section-title">Secrets</h2>
                    <span
                        class="filter-checkbox admin-only"
                        id="secrets-only-mine-cb"
                        onclick="toggleSecretsOnlyMine()"
                    ></span>
                </div>
                <div class="list-group" id="mtproxy-secret-list"></div>
            </div>

            <!-- Page: Admin -->
            <div class="page" id="page-admin">
                <header class="header">
                    <div class="admin-avatar" id="admin-avatar"></div>
                    <h1 class="bot-title" id="admin-name"></h1>
                    <p class="bot-subtitle" id="admin-role"></p>
                    <p class="bot-subtitle" id="admin-version" style="margin-top: 4px; font-size: 12px; opacity: 0.6"></p>
                </header>
                <h2 class="section-title">Database</h2>
                <div class="action-btn" onclick="backupDB()">
                    <div class="action-icon-circle admin">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                            />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                    </div>
                    <div class="action-text admin">Backup Database</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn" onclick="restoreDB()">
                    <div class="action-icon-circle admin">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                            />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" y1="3" x2="12" y2="15" />
                        </svg>
                    </div>
                    <div class="action-text admin">Restore Database</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <input
                    type="file"
                    id="restore-file-input"
                    accept=".db,.sqlite,.sqlite3,.bak"
                    style="display: none"
                    onchange="handleRestoreFile(this)"
                />

                <!-- Password Modal (for backup/restore) -->
                <div
                    class="modal-backdrop"
                    id="password-modal-backdrop"
                    onclick="closePasswordModal()"
                ></div>
                <div class="modal-sheet" id="password-modal-sheet">
                    <div class="modal-header">
                        <button
                            class="modal-btn cancel"
                            onclick="closePasswordModal()"
                        >
                            Cancel
                        </button>
                        <span class="modal-title" id="password-modal-title"
                            >Password</span
                        >
                        <button
                            class="modal-btn done admin"
                            onclick="submitPasswordModal()"
                        >
                            Done
                        </button>
                    </div>
                    <div class="modal-content">
                        <div class="input-group">
                            <label class="input-label" id="password-modal-label"
                                >Enter password</label
                            >
                            <input
                                type="password"
                                class="tg-input"
                                id="inp-modal-password"
                                placeholder="Password"
                            />
                        </div>
                    </div>
                </div>
                <h2 class="section-title">Instance</h2>
                <div class="action-btn" onclick="restartInstance()">
                    <div class="action-icon-circle admin">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M23 4v6h-6" />
                            <path d="M1 20v-6h6" />
                            <path
                                d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                            />
                        </svg>
                    </div>
                    <div class="action-text admin">Restart Instance</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
                <div class="action-btn" onclick="promptResetInstance()">
                    <div class="action-icon-circle destructive">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polyline points="1 4 1 10 7 10" />
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
                        </svg>
                    </div>
                    <div class="action-text destructive">Reset Instance</div>
                    <svg class="chevron" viewBox="0 0 8 14">
                        <path
                            d="M1 1L7 7L1 13"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                        />
                    </svg>
                </div>
            </div>

            <!-- Tab Navigation -->
            <nav class="tab-nav">
                <div
                    class="tab-item active"
                    data-page="peers"
                    onclick="switchTab('peers')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"
                        />
                    </svg>
                    <span>Peers</span>
                </div>
                <div
                    class="tab-item mtproxy"
                    data-page="mtproxy"
                    onclick="switchTab('mtproxy')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                        />
                    </svg>
                    <span>MTProxy</span>
                </div>
                <div
                    class="tab-item admin-only"
                    data-page="upstreams"
                    onclick="switchTab('upstreams')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                    </svg>
                    <span>Upstreams</span>
                </div>
                <div
                    class="tab-item"
                    data-page="proxies"
                    onclick="switchTab('proxies')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <rect
                            x="2"
                            y="3"
                            width="20"
                            height="14"
                            rx="2"
                            ry="2"
                        />
                        <line x1="8" y1="21" x2="16" y2="21" />
                        <line x1="12" y1="17" x2="12" y2="21" />
                    </svg>
                    <span>Proxies</span>
                </div>
                <div
                    class="tab-item dns admin-only"
                    data-page="dns"
                    onclick="switchTab('dns')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    <span>DNS</span>
                </div>
                <div
                    class="tab-item routing admin-only"
                    data-page="routing"
                    onclick="switchTab('routing')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M22 12h-4l-3 9L9 3l-3 9H2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                    </svg>
                    <span>Routing</span>
                </div>
                <div
                    class="tab-item users admin-only"
                    data-page="users"
                    onclick="switchTab('users')"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                    <span>Users</span>
                </div>
            </nav>
        </div>

        <!-- Peer Modal (Create) -->
        <div
            class="modal-backdrop"
            id="peer-modal-backdrop"
            onclick="closePeerModal()"
        ></div>
        <div class="modal-sheet" id="peer-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closePeerModal()">
                    Cancel
                </button>
                <span class="modal-title">New Peer</span>
                <button class="modal-btn done wg" onclick="savePeer()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Peer Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-peer-name"
                        placeholder="iPhone 15 Pro"
                    />
                </div>
            </div>
        </div>

        <!-- Peer Edit Modal -->
        <div
            class="modal-backdrop"
            id="peer-edit-modal-backdrop"
            onclick="closePeerEditModal()"
        ></div>
        <div class="modal-sheet" id="peer-edit-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closePeerEditModal()">
                    Cancel
                </button>
                <span class="modal-title">Edit Peer</span>
                <button class="modal-btn done wg" onclick="savePeerEdit()">
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Peer Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-peer-edit-name"
                        placeholder="iPhone 15 Pro"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Status</label>
                    <div class="toggle-row" onclick="togglePeerEditDisabled()">
                        <span class="toggle-label" id="peer-edit-status-label"
                            >Enabled</span
                        >
                        <div
                            class="toggle-switch active"
                            id="peer-edit-enabled-toggle"
                        >
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Exclude Private IPs</label>
                    <div class="input-hint">
                        Exclude IPs 10.0.0.0/8, 127.0.0.0/8, 172.16.0.0/12,
                        192.168.0.0/16 from routing.
                    </div>
                    <div
                        class="toggle-row"
                        onclick="togglePeerEditExcludePrivate()"
                    >
                        <span
                            class="toggle-label"
                            id="peer-edit-exclude-private-label"
                            >Enabled</span
                        >
                        <div
                            class="toggle-switch active"
                            id="peer-edit-exclude-private-toggle"
                        >
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Exclude Server IP</label>
                    <div class="input-hint">
                        Exclude VPN server IP from routing through the tunnel
                    </div>
                    <div
                        class="toggle-row"
                        onclick="togglePeerEditExcludeServer()"
                    >
                        <span
                            class="toggle-label"
                            id="peer-edit-exclude-server-label"
                            >Enabled</span
                        >
                        <div
                            class="toggle-switch active"
                            id="peer-edit-exclude-server-toggle"
                        >
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-peer-edit-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label">Public Key</label>
                    <div
                        class="info-value truncate"
                        id="peer-edit-pubkey"
                    ></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Allowed IPs</label>
                    <div class="info-value" id="peer-edit-allowed-ips"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Stats</label>
                    <div class="peer-stats-row" id="peer-edit-stats"></div>
                </div>
            </div>
        </div>

        <!-- Upstream Modal -->
        <div
            class="modal-backdrop"
            id="upstream-modal-backdrop"
            onclick="closeUpstreamModal()"
        ></div>
        <div class="modal-sheet" id="upstream-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeUpstreamModal()">
                    Cancel
                </button>
                <span class="modal-title" id="upstream-modal-title"
                    >New Upstream</span
                >
                <button
                    class="modal-btn done upstream"
                    onclick="saveUpstream()"
                >
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Name</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-upstream-name"
                        placeholder="My Upstream"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Transport URI</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-upstream-transport"
                        placeholder="ss://..."
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Groups (comma-separated)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-upstream-groups"
                        placeholder="group1, group2"
                    />
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Default</div>
                        <div class="toggle-sublabel">
                            Use as default upstream
                        </div>
                    </div>
                    <div
                        class="toggle-switch"
                        id="inp-upstream-default"
                        onclick="toggleUpstreamDefault()"
                    >
                        <div class="toggle-knob"></div>
                    </div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Health Check</div>
                        <div class="toggle-sublabel">Monitor availability</div>
                    </div>
                    <div
                        class="toggle-switch"
                        id="inp-upstream-health"
                        onclick="toggleUpstreamHealth()"
                    >
                        <div class="toggle-knob"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upstream Edit Modal -->
        <div
            class="modal-backdrop"
            id="upstream-edit-modal-backdrop"
            onclick="closeUpstreamEditModal()"
        ></div>
        <div class="modal-sheet" id="upstream-edit-modal-sheet">
            <div class="modal-header">
                <button
                    class="modal-btn cancel"
                    onclick="closeUpstreamEditModal()"
                >
                    Cancel
                </button>
                <span class="modal-title">Edit Upstream</span>
                <button
                    class="modal-btn done upstream"
                    onclick="saveUpstreamEdit()"
                >
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Name</label>
                    <div class="info-value" id="upstream-edit-name"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Type</label>
                    <div class="info-value" id="upstream-edit-type"></div>
                </div>
                <div class="input-group">
                    <label class="input-label"
                        >Transport URI (leave empty to keep current)</label
                    >
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-upstream-edit-transport"
                        placeholder="ss://... (leave empty to keep)"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Groups (comma-separated)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-upstream-edit-groups"
                        placeholder="group1, group2"
                    />
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Default</div>
                        <div class="toggle-sublabel">
                            Use as default upstream
                        </div>
                    </div>
                    <div
                        class="toggle-switch"
                        id="inp-upstream-edit-default"
                        onclick="toggleUpstreamEditDefault()"
                    >
                        <div class="toggle-knob"></div>
                    </div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Health Check</div>
                        <div class="toggle-sublabel">Monitor availability</div>
                    </div>
                    <div
                        class="toggle-switch"
                        id="inp-upstream-edit-health"
                        onclick="toggleUpstreamEditHealth()"
                    >
                        <div class="toggle-knob"></div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Status</label>
                    <div class="peer-stats-row" id="upstream-edit-stats"></div>
                </div>
            </div>
        </div>

        <!-- Group Modal -->
        <div
            class="modal-backdrop"
            id="group-modal-backdrop"
            onclick="closeGroupModal()"
        ></div>
        <div class="modal-sheet" id="group-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeGroupModal()">
                    Cancel
                </button>
                <span class="modal-title">New Group</span>
                <button class="modal-btn done upstream" onclick="saveGroup()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Group Name</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-group-name"
                        placeholder="my-group"
                    />
                </div>
            </div>
        </div>

        <!-- Group Edit Modal -->
        <div
            class="modal-backdrop"
            id="group-edit-modal-backdrop"
            onclick="closeGroupEditModal()"
        ></div>
        <div class="modal-sheet" id="group-edit-modal-sheet">
            <div class="modal-header">
                <button
                    class="modal-btn cancel"
                    onclick="closeGroupEditModal()"
                >
                    Cancel
                </button>
                <span class="modal-title" id="group-edit-modal-title"
                    >Edit Group</span
                >
                <button
                    class="modal-btn done upstream"
                    onclick="saveGroupEdit()"
                >
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Upstream Members</label>
                    <div id="group-edit-members"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Consumers</label>
                    <div id="group-edit-consumers" class="info-value"></div>
                </div>
            </div>
        </div>

        <!-- Proxy Server Modal -->
        <div
            class="modal-backdrop"
            id="proxy-modal-backdrop"
            onclick="closeProxyModal()"
        ></div>
        <div class="modal-sheet" id="proxy-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeProxyModal()">
                    Cancel
                </button>
                <span class="modal-title">Add Proxy Server</span>
                <button class="modal-btn done" onclick="saveProxy()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Name (optional)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-proxy-name"
                        placeholder="my-proxy"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Type</label
                    ><select class="tg-input" id="inp-proxy-type">
                        <option value="socks5">SOCKS5</option>
                        <option value="http">HTTP</option>
                        <option value="https">HTTPS</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Port</label
                    ><input
                        type="number"
                        class="tg-input"
                        id="inp-proxy-port"
                        placeholder="1080"
                        min="1"
                        max="65535"
                        oninput="checkPortAvailability()"
                    />
                    <div class="input-hint" id="proxy-port-hint"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Username (optional)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-proxy-username"
                        placeholder="user"
                        autocomplete="off"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Password (optional)</label>
                    <div class="input-with-btn">
                        <input
                            type="text"
                            class="tg-input"
                            id="inp-proxy-password"
                            placeholder="password"
                            autocomplete="off"
                        />
                        <div
                            class="input-inline-btn"
                            onclick="generateProxyPassword()"
                        >
                            ‚ü≥
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Proxy Edit Modal -->
        <div
            class="modal-backdrop"
            id="proxy-edit-modal-backdrop"
            onclick="closeProxyEditModal()"
        ></div>
        <div class="modal-sheet" id="proxy-edit-modal-sheet">
            <div class="modal-header">
                <button
                    class="modal-btn cancel"
                    onclick="closeProxyEditModal()"
                >
                    Cancel
                </button>
                <span class="modal-title">Edit Proxy</span>
                <button class="modal-btn done" onclick="saveProxyEdit()">
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Name</label>
                    <div class="info-value" id="proxy-edit-name"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Type</label>
                    <div class="info-value" id="proxy-edit-type"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Listen</label>
                    <div class="info-value" id="proxy-edit-listen"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-proxy-edit-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label"
                        >Username (leave empty to keep)</label
                    >
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-proxy-edit-username"
                        placeholder="user"
                        autocomplete="off"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label"
                        >Password (leave empty to keep)</label
                    >
                    <div class="input-with-btn">
                        <input
                            type="text"
                            class="tg-input"
                            id="inp-proxy-edit-password"
                            placeholder="password"
                            autocomplete="off"
                        />
                        <div
                            class="input-inline-btn"
                            onclick="generateProxyPassword()"
                        >
                            ‚ü≥
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DNS Rule Modal -->
        <div
            class="modal-backdrop"
            id="dns-rule-modal-backdrop"
            onclick="closeDNSRuleModal()"
        ></div>
        <div class="modal-sheet" id="dns-rule-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeDNSRuleModal()">
                    Cancel
                </button>
                <span class="modal-title" id="dns-rule-modal-title">New DNS Rule</span>
                <button class="modal-btn done dns" onclick="saveDNSRule()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Rule Name</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-rule-name"
                        placeholder="Block Ads"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Action</label
                    ><select
                        class="tg-input"
                        id="inp-dns-rule-action"
                        onchange="toggleDNSRuleAction()"
                    >
                        <option value="block">Block (NXDOMAIN)</option>
                        <option value="upstream">Use Specific Upstream</option>
                    </select>
                </div>
                <div
                    class="input-group"
                    id="dns-rule-upstream-group"
                    style="display: none"
                >
                    <label class="input-label">Upstream Address</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-rule-upstream"
                        placeholder="8.8.8.8:53"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Domains (comma-separated)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-rule-domains"
                        placeholder="*.ads.com, tracker.net"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Apply to Peers (empty = all)</label>
                    <div id="dns-rule-peer-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Known Blocklists</label>
                    <div id="dns-rule-blocklist-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Custom Blocklist URL (optional)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-rule-list-url"
                        placeholder="https://example.com/blocklist.txt"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">List Format</label
                    ><select class="tg-input" id="inp-dns-rule-list-format">
                        <option value="auto">Auto</option>
                        <option value="domains">Domains</option>
                        <option value="hosts">Hosts file</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- DNS Record Modal -->
        <div
            class="modal-backdrop"
            id="dns-record-modal-backdrop"
            onclick="closeDNSRecordModal()"
        ></div>
        <div class="modal-sheet" id="dns-record-modal-sheet">
            <div class="modal-header">
                <button
                    class="modal-btn cancel"
                    onclick="closeDNSRecordModal()"
                >
                    Cancel
                </button>
                <span class="modal-title" id="dns-record-modal-title"
                    >New DNS Record</span
                >
                <button class="modal-btn done dns" onclick="saveDNSRecord()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Domain Name</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-record-name"
                        placeholder="example.com"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label"
                        >A Records (comma-separated IPv4)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-record-a"
                        placeholder="1.2.3.4, 5.6.7.8"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label"
                        >AAAA Records (comma-separated IPv6)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-dns-record-aaaa"
                        placeholder="::1"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">TTL (seconds)</label
                    ><input
                        type="number"
                        class="tg-input"
                        id="inp-dns-record-ttl"
                        value="3600"
                    />
                </div>
            </div>
        </div>

        <!-- User Modal -->
        <div
            class="modal-backdrop"
            id="user-modal-backdrop"
            onclick="closeUserModal()"
        ></div>
        <div class="modal-sheet" id="user-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeUserModal()">
                    Cancel
                </button>
                <span class="modal-title">Add User</span>
                <button class="modal-btn done users" onclick="saveUser()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label"
                        >@username or Telegram User ID</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-user-input"
                        placeholder="@username or 123456789"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Role</label
                    ><select class="tg-input" id="inp-user-role">
                        <option value="guest">Guest</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Custom Name (optional)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-user-custom-name"
                        placeholder="Display name"
                    />
                </div>
            </div>
        </div>

        <!-- User Edit Modal -->
        <div
            class="modal-backdrop"
            id="user-edit-modal-backdrop"
            onclick="closeUserEditModal()"
        ></div>
        <div class="modal-sheet" id="user-edit-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeUserEditModal()">
                    Cancel
                </button>
                <span class="modal-title">Edit User</span>
                <button class="modal-btn done users" onclick="saveUserEdit()">
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">User</label>
                    <div class="info-value" id="user-edit-info"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Custom Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-user-edit-custom-name"
                        placeholder="Display name"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Role</label>
                    <select class="tg-input" id="inp-user-edit-role">
                        <option value="guest">Guest</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Status</label>
                    <div class="toggle-row" onclick="toggleUserEditDisabled()">
                        <span class="toggle-label" id="user-edit-status-label"
                            >Enabled</span
                        >
                        <div
                            class="toggle-switch active"
                            id="user-edit-enabled-toggle"
                        >
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
                <div class="input-group" id="user-edit-limits-group">
                    <label class="input-label">Limits</label>
                    <div style="display: flex; gap: 8px">
                        <div style="flex: 1">
                            <label
                                class="input-label"
                                style="font-size: 12px; margin-bottom: 2px"
                                >Max Peers</label
                            >
                            <input
                                type="number"
                                class="tg-input"
                                id="inp-user-edit-max-peers"
                                placeholder="default (5)"
                                min="0"
                            />
                        </div>
                        <div style="flex: 1">
                            <label
                                class="input-label"
                                style="font-size: 12px; margin-bottom: 2px"
                                >Max Secrets</label
                            >
                            <input
                                type="number"
                                class="tg-input"
                                id="inp-user-edit-max-secrets"
                                placeholder="default (5)"
                                min="0"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invite Modal -->
        <div
            class="modal-backdrop"
            id="invite-modal-backdrop"
            onclick="closeInviteModal()"
        ></div>
        <div class="modal-sheet" id="invite-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeInviteModal()">
                    Cancel
                </button>
                <span class="modal-title">Create Invite Link</span>
                <button class="modal-btn done users" onclick="saveInvite()">
                    Create
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Role</label>
                    <select class="tg-input" id="inp-invite-role">
                        <option value="guest">Guest</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Secret Edit Modal -->
        <div
            class="modal-backdrop"
            id="secret-edit-modal-backdrop"
            onclick="closeSecretEditModal()"
        ></div>
        <div class="modal-sheet" id="secret-edit-modal-sheet">
            <div class="modal-header">
                <button
                    class="modal-btn cancel"
                    onclick="closeSecretEditModal()"
                >
                    Cancel
                </button>
                <span class="modal-title">Edit Secret</span>
                <button
                    class="modal-btn done mtproxy"
                    onclick="saveSecretEdit()"
                >
                    Save
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-secret-edit-name"
                        placeholder="My Proxy"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Secret</label>
                    <div class="info-value truncate" id="secret-edit-hex"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Type</label>
                    <div class="info-value" id="secret-edit-type"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-secret-edit-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label">Stats</label>
                    <div class="peer-stats-row" id="secret-edit-stats"></div>
                </div>
            </div>
        </div>

        <!-- Secret Modal -->
        <div
            class="modal-backdrop"
            id="secret-modal-backdrop"
            onclick="closeSecretModal()"
        ></div>
        <div class="modal-sheet" id="secret-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeSecretModal()">
                    Cancel
                </button>
                <span class="modal-title">New Secret</span>
                <button class="modal-btn done mtproxy" onclick="saveSecret()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Secret Type</label
                    ><select class="tg-input" id="inp-secret-type">
                        <option value="faketls">FakeTLS (ee)</option>
                        <option value="padded">Padded (dd)</option>
                        <option value="default">Default</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Comment (optional)</label
                    ><input
                        type="text"
                        class="tg-input"
                        id="inp-secret-comment"
                        placeholder="Main proxy"
                    />
                </div>
            </div>
        </div>

        <!-- CIDR Edit Modal -->
        <div
            class="modal-backdrop"
            id="cidr-edit-modal-backdrop"
            onclick="closeCIDREditModal()"
        ></div>
        <div class="modal-sheet" id="cidr-edit-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeCIDREditModal()">
                    Cancel
                </button>
                <span class="modal-title" id="cidr-edit-modal-title"
                    >Edit CIDR</span
                >
                <button class="modal-btn done routing" onclick="saveCIDREdit()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Mode</label>
                    <select class="tg-input" id="inp-cidr-edit-mode">
                        <option value="allow">Allow (include)</option>
                        <option value="disallow">Direct (bypass)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">IP Range (CIDR)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-cidr-edit-range"
                        placeholder="10.0.0.0/8"
                    />
                </div>
            </div>
        </div>

        <!-- IP Rule Modal -->
        <div
            class="modal-backdrop"
            id="ip-rule-modal-backdrop"
            onclick="closeIPRuleModal()"
        ></div>
        <div class="modal-sheet" id="ip-rule-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeIPRuleModal()">
                    Cancel
                </button>
                <span class="modal-title" id="ip-rule-modal-title"
                    >Add IP Rule</span
                >
                <button class="modal-btn done routing" onclick="saveIPRule()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Rule Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-ip-rule-name"
                        placeholder="ru-direct"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Action</label>
                    <select
                        class="tg-input"
                        id="inp-ip-rule-action"
                        onchange="toggleIPRuleAction()"
                    >
                        <option value="direct">Direct (bypass proxy)</option>
                        <option value="upstream">Use Upstream Group</option>
                    </select>
                </div>
                <div
                    class="input-group"
                    id="ip-rule-upstream-group"
                    style="display: none"
                >
                    <label class="input-label">Upstream Group</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-ip-rule-upstream-group"
                        placeholder="group-name"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">CIDRs / ASNs</label>
                    <div id="ip-rule-entries"></div>
                    <button
                        type="button"
                        class="add-entry-btn"
                        onclick="addIPRuleEntry()"
                    >
                        + Add Entry
                    </button>
                </div>
                <div class="input-group">
                    <label class="input-label">IP List URL (optional)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-ip-rule-list-url"
                        placeholder="https://example.com/iplist.txt"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Apply to Peers (empty = all)</label>
                    <div id="ip-rule-peer-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SNI Rule Modal -->
        <div
            class="modal-backdrop"
            id="sni-rule-modal-backdrop"
            onclick="closeSNIRuleModal()"
        ></div>
        <div class="modal-sheet" id="sni-rule-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeSNIRuleModal()">
                    Cancel
                </button>
                <span class="modal-title" id="sni-rule-modal-title"
                    >Add SNI Rule</span
                >
                <button class="modal-btn done routing" onclick="saveSNIRule()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Rule Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-sni-rule-name"
                        placeholder="ru-domains"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Action</label>
                    <select
                        class="tg-input"
                        id="inp-sni-rule-action"
                        onchange="toggleSNIRuleAction()"
                    >
                        <option value="direct">Direct (bypass proxy)</option>
                        <option value="upstream">Use Upstream Group</option>
                    </select>
                </div>
                <div
                    class="input-group"
                    id="sni-rule-upstream-group"
                    style="display: none"
                >
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-sni-rule-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label">Domains (comma-separated)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-sni-rule-domains"
                        placeholder="*.example.com, site.org"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Apply to Peers (empty = all)</label>
                    <div id="sni-rule-peer-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Port Rule Modal -->
        <div
            class="modal-backdrop"
            id="port-rule-modal-backdrop"
            onclick="closePortRuleModal()"
        ></div>
        <div class="modal-sheet" id="port-rule-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closePortRuleModal()">
                    Cancel
                </button>
                <span class="modal-title" id="port-rule-modal-title"
                    >Add Port Rule</span
                >
                <button class="modal-btn done routing" onclick="savePortRule()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Rule Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-port-rule-name"
                        placeholder="block-torrent-ports"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Action</label>
                    <select
                        class="tg-input"
                        id="inp-port-rule-action"
                        onchange="togglePortRuleAction()"
                    >
                        <option value="block">Block</option>
                        <option value="direct">Direct (bypass proxy)</option>
                        <option value="upstream">Use Upstream Group</option>
                    </select>
                </div>
                <div
                    class="input-group"
                    id="port-rule-upstream-group"
                    style="display: none"
                >
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-port-rule-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label">Ports (comma-separated, e.g. 6881, 6881-6889)</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-port-rule-ports"
                        placeholder="6881-6889, 6969"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Apply to Peers (empty = all)</label>
                    <div id="port-rule-peer-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Protocol Rule Modal -->
        <div
            class="modal-backdrop"
            id="protocol-rule-modal-backdrop"
            onclick="closeProtocolRuleModal()"
        ></div>
        <div class="modal-sheet" id="protocol-rule-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeProtocolRuleModal()">
                    Cancel
                </button>
                <span class="modal-title" id="protocol-rule-modal-title"
                    >Add Protocol Rule</span
                >
                <button class="modal-btn done routing" onclick="saveProtocolRule()">
                    Done
                </button>
            </div>
            <div class="modal-content">
                <div class="input-group">
                    <label class="input-label">Rule Name</label>
                    <input
                        type="text"
                        class="tg-input"
                        id="inp-protocol-rule-name"
                        placeholder="block-bittorrent"
                    />
                </div>
                <div class="input-group">
                    <label class="input-label">Action</label>
                    <select
                        class="tg-input"
                        id="inp-protocol-rule-action"
                        onchange="toggleProtocolRuleAction()"
                    >
                        <option value="block">Block</option>
                        <option value="direct">Direct (bypass proxy)</option>
                        <option value="upstream">Use Upstream Group</option>
                    </select>
                </div>
                <div
                    class="input-group"
                    id="protocol-rule-upstream-group"
                    style="display: none"
                >
                    <label class="input-label">Upstream Group</label>
                    <select
                        class="tg-input"
                        id="inp-protocol-rule-upstream-group"
                    ></select>
                </div>
                <div class="input-group">
                    <label class="input-label">Protocols</label>
                    <div id="protocol-rule-picker"></div>
                </div>
                <div class="input-group">
                    <label class="input-label">Apply to Peers (empty = all)</label>
                    <div id="protocol-rule-peer-picker" class="blocklist-picker">
                        <div class="empty-state" style="font-size:13px">Loading‚Ä¶</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Config/QR Modal -->
        <div
            class="modal-backdrop"
            id="config-modal-backdrop"
            onclick="closeConfigModal()"
        ></div>
        <div class="modal-sheet" id="config-modal-sheet">
            <div class="modal-header">
                <button class="modal-btn cancel" onclick="closeConfigModal()">
                    Close
                </button>
                <span class="modal-title" id="config-modal-title">Config</span>
                <div id="config-action-btns">
                    <button
                        class="action-icon-btn"
                        onclick="downloadConfig()"
                        title="Download"
                    >
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                            />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                    </button>
                    <button
                        class="action-icon-btn"
                        onclick="copyConfig()"
                        title="Copy"
                    >
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <rect
                                x="9"
                                y="9"
                                width="13"
                                height="13"
                                rx="2"
                                ry="2"
                            />
                            <path
                                d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                            />
                        </svg>
                    </button>
                    <button
                        class="action-icon-btn"
                        onclick="sendConfigToTelegram()"
                        title="Send to Telegram"
                    >
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M22 2L11 13" />
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-content" id="config-modal-content"></div>
        </div>

        <!-- Delete Alert -->
        <div class="alert-overlay" id="alert-overlay">
            <div class="alert-box">
                <div class="alert-title">Delete Item?</div>
                <div class="alert-message" id="alert-message">
                    Are you sure? This action cannot be undone.
                </div>
                <div class="alert-buttons">
                    <button class="alert-btn cancel" onclick="closeAlert()">
                        Cancel
                    </button>
                    <button class="alert-btn delete" id="confirm-delete-btn">
                        Delete
                    </button>
                </div>
            </div>
        </div>

        <!-- Reset Confirm Alert -->
        <div class="alert-overlay" id="reset-alert-overlay">
            <div class="alert-box">
                <div class="alert-title">Reset Instance?</div>
                <div class="alert-message" id="reset-alert-message"></div>
                <div class="alert-buttons">
                    <button
                        class="alert-btn cancel"
                        onclick="closeResetAlert()"
                    >
                        Cancel
                    </button>
                    <button
                        class="alert-btn destructive"
                        id="reset-confirm-btn"
                        disabled
                        onclick="confirmResetInstance()"
                    >
                        Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast">
            <svg
                id="toast-icon-success"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <polyline points="20 6 9 17 4 12" />
            </svg>
            <svg
                id="toast-icon-error"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="display: none"
            >
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
            <span id="toast-message">Done</span>
        </div>

        <script src="app.js"></script>
    </body>
</html>
